-- HAYLEY JOLLIFFE
-- Week 12

USE northwind_w12

-- Step 01
DROP TRIGGER IF EXISTS northwind_w12.monitor_shippers;

DELIMITER $$

-- Set log table
CREATE TABLE IF NOT EXISTS log_monitor_shippers (
    `ShipperID` INT NOT NULL,
    `CompanyName` VARCHAR(40) NOT NULL,
    `Phone` VARCHAR(24) DEFAULT NULL,
    `UpdateDate` = TIME,
    `ActionType` = VARCHAR(40)
);

-- Start trigger
CREATE TRIGGER monitor_shippers
AFTER UPDATE
ON Shippers FOR EACH ROW
SET
ShipperID = NEW.ShipperID,
CompanyName = NEW.CompanyName,
Phone = NEW.Phone,
UpdateDate = NOW();
ActionType = 'Update';
INSERT INTO log_monitor_shippers(ShipperID, CompanyName, Phone, UpdateDate, ActionType)
VALUES (NEW.ShipperID, NEW.CompanyName, NEW.Phone, NEW.UpdateDate, ActionType);

END $$

DELIMITER ;

-- Step 02
DROP TRIGGER IF EXISTS northwind_w12.update_shippers;

DELIMITER $$

-- Set log table
CREATE TABLE IF NOT EXISTS log_update_shippers (
    `CompanyName` VARCHAR(40) NOT NULL,
    `Phone` VARCHAR(24) DEFAULT NULL;
);

-- Start trigger
CREATE TRIGGER update_shippers
AFTER UPDATE
ON Shippers FOR EACH ROW
BEGIN
IF NEW.CompanyName <=> OLD.CompanyName
THEN
INSERT INTO log_update_shippers(CompanyName, Phone)
VALUES (NEW.CompanyName, NEW.Phone);
END IF;

END $$

DELIMITER ;

-- Step 03
DROP TRIGGER IF EXISTS northwind_w12.update_orders

DELIMITER $$

-- Set log table
CREATE TABLE IF NOT EXISTS log_update_orders (
    `OrderID` = INT NOT NULL,
    `Total` = INT NOT NULL,
    `OrderTime` = VARCHAR(40),
    `ActionType` = VARCHAR(40)
);

-- Start trigger
CREATE TRIGGER update_orders
AFTER INSERT
ON OrderDetails FOR EACH ROW
IF (NEW.Quantity * NEW.UnitPrice => 5000)
THEN
INSERT INTO log_update_orders(OrderID, Total, OrderTime, ActionType)
VALUES (NEW.OrderID, (NEW.Quantity * NEW.UnitPrice), NOW(), 'Update');
END IF;

END $$

DELIMITER ;

-- Step 04

-- Step 05
