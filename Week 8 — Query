--
-- HAYLEY JOLLIFFE
-- Week 8 Lab for INFO-3169
--


--
-- Step 1: Update employee 206's phone number to 515.321.1818 in Employee
-- and location ID to 1800 in Department
--
UPDATE employees
INNER JOIN departments
ON employees.DEPARTMENT_ID = departments.DEPARTMENT_ID
SET employees.PHONE_NUMBER = "515.321.1818", departments.LOCATION_ID = 1800
WHERE employee_ID = 206;
-- DONE, confirmed with Tina, DO NOT TOUCH

--
-- Step 2: Update Jennifer Whalen's Department and Job IDs to 80
-- and 'SA_REP' to Job History
--
UPDATE job_history
SET DEPARTMENT_ID=80 ,JOB_ID='SA_REP'
WHERE EMPLOYEE_ID IN (SELECT EMPLOYEE_ID FROM employees
WHERE FIRST_NAME like 'Jennifer' AND LAST_NAME like 'Whalen');
-- DONE, confirmed with Dan, DO NOT TOUCH

--
-- Step 3: Lock employees with READ table in Session 1, then try to
-- insert a record into Session 2. Screenshot the result.
-- Unlock the table and screenshot again.
--
LOCK TABLES employees READ;
UPDATE employees
SET EMPLOYEE_ID=400
WHERE EMPLOYEE_ID=200;
UNLOCK TABLES;

-- Session 1
LOCK TABLES employees READ;
UNLOCK TABLES;

-- Session 2
UPDATE employees
SET EMPLOYEE_ID=400
WHERE EMPLOYEE_ID=200;

--
-- Step 4: Lock employees with WRITE table in Session 1, then try to
-- select all records in Session 2. Screenshot the result.
-- Unlock the table and screenshot again.
--
LOCK TABLES employees WRITE;
SELECT * FROM employees;
UNLOCK TABLES;

-- Session 1
LOCK TABLES employees WRITE;
UNLOCK TABLES;

-- Session 2
SELECT * FROM employees;

--
-- Step 5: Write a COMMIT transaction
-- 5A - Get max. Employee ID
-- 5B - Insert a record in Employee with this ID
-- 5C - Insert a record in Job History
-- 5D - Commit
--
BEGIN TRANSACTION;
UPDATE employees
SET FIRST_NAME='Pickle'
WHERE EMPLOYEE_ID=MAX(EMPLOYEE_ID);
UPDATE job_history
SET END_DATE='2038-01-19'
WHERE EMPLOYEE_ID=MAX(EMPLOYEE_ID);
COMMIT;

--
-- Step 6: Write a ROLLBACK transaction
-- 6A - Get max. Employee ID
-- 6B - Insert a record in Employee with this ID
-- 6C - Insert a record in Job History
-- 6D - Rollback
--
ALTER TABLE jobs_history ENGINE = InnoDB;
ALTER TABLE employees ENGINE = InnoDB;

BEGIN TRANSACTION;
INSERT INTO employees
VALUES '500', 'Pickle', 'Rick', 'PRICK', '515.042.9876', '1970-01-01', 'MK_MAN', '13000.00', '99000.00', '0.00', '100', '20'
WHERE EMPLOYEE_ID=MAX(EMPLOYEE_ID);
ROLLBACK;

--
-- Step 7: Delete record created in Step 5 using JOIN
--
DELETE FROM employees.FIRST_NAME, job_history.END_DATE
INNER JOIN job_history
ON employees.EMPLOYEE_ID = job_history.EMPLOYEE_ID
WHERE EMPLOYEE_ID=MAX(EMPLOYEE_ID);

--
-- Step 8: Delete record in Job History for Jennifer Whalen using SUBQUERY
--
DELETE FROM job_history
WHERE (SELECT FROM employees
WHERE first_name LIKE 'Jennifer'
AND last_name LIKE 'Whalen');
